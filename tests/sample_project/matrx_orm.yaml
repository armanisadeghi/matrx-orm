# =============================================================================
# matrx-orm configuration
# =============================================================================
#
# This file drives reverse-migration schema generation.
# Run:  python generate.py
#
# =============================================================================
# Output
# =============================================================================
#
# Output paths are machine-specific and must NOT be committed to git.
# Set them in your local .env file instead:
#
#   MATRX_PYTHON_ROOT=/absolute/path/to/your/python/project
#   MATRX_TS_ROOT=/absolute/path/to/your/nextjs/project   # only needed if typescript: true
#   MATRX_SAVE_DIRECT=true                                 # optional override
#
# MATRX_PYTHON_ROOT is required — generation will abort without it.
# MATRX_TS_ROOT is only required when typescript: true.
#
# save_direct controls whether generated files overwrite your live source
# files or go to a temporary staging directory instead.
#
#   false (default) — safe mode: files go to a temp dir for review first.
#   true            — live mode: files write directly to MATRX_PYTHON_ROOT /
#                     MATRX_TS_ROOT. matrx-orm refuses to run if either root
#                     has uncommitted git changes (protects hand-written code).
#
output:
  save_direct: false

  # Set typescript: false if this is a Python-only project (no Next.js output).
  # MATRX_TS_ROOT is ignored when typescript is false.
  python: true
  typescript: false
  json: true

# =============================================================================
# Databases
# =============================================================================
# Add as many databases as you need. Each entry needs a unique name.
# The env_prefix tells matrx-orm which environment variables hold the
# connection details.  For a prefix of "PRIMARY_DB" it reads:
#   PRIMARY_DB_HOST, PRIMARY_DB_PORT, PRIMARY_DB_NAME,
#   PRIMARY_DB_USER, PRIMARY_DB_PASSWORD
#   PRIMARY_DB_PROTOCOL  (optional, defaults to "postgresql")
#
databases:
  - name: primary
    env_prefix: PRIMARY_DB
    additional_schemas:
      - auth

  # Add a second database entry if you have one. Generated files for the
  # second database will go to db/secondary/ alongside db/ for the primary.
  # - name: secondary
  #   env_prefix: SECONDARY_DB
  #   additional_schemas:
  #     - auth

# =============================================================================
# Schema generation
# =============================================================================
# Each entry below triggers one reverse-migration run.
# database must match a name defined in the databases section above.
#
# Table filtering (mutually exclusive — use one or neither):
#   include_tables: [table_a, table_b]   — only generate these tables
#   exclude_tables: [table_x, table_y]   — generate everything except these
#
# manager_flags controls which methods are included in each generated manager
# class. These map directly to the code-generation layer — changing them
# affects what methods every developer gets in their generated managers.
#
# Defaults shown below exactly match the built-in system defaults.
# Only override what you need to change.
#
generate:
  - database: primary
    schema: public
    # include_tables:
    #   - my_table
    #   - other_table
    # exclude_tables:
    #   - internal_table
    manager_flags:
      include_core_relations: true      # FK/IFK fetch methods (load_by_*, fetch_fk, fetch_ifk)
      include_filter_fields: true       # filter_by_* methods for indexed/common lookup fields
      include_active_relations: false   # active-record style relation traversal
      include_active_methods: false     # active-record create/update/delete on instance
      include_or_not_methods: false     # load_or_create, update_or_create helpers
      include_to_dict_methods: false    # to_dict() / to_json() serializers
      include_to_dict_relations: false  # include related objects in to_dict() output

  # Uncomment to also generate from the secondary database:
  # - database: secondary
  #   schema: public
  #   manager_flags:
  #     include_core_relations: true
  #     include_filter_fields: true
  #     include_active_relations: false
  #     include_active_methods: false
  #     include_or_not_methods: false
  #     include_to_dict_methods: false
  #     include_to_dict_relations: false

# =============================================================================
# Debug
# =============================================================================
# Controls console output during generation.
# Can also be set per-run via env vars: MATRX_INFO, MATRX_DEBUG, MATRX_VERBOSE
#
debug:
  info: true
  debug: false
  verbose: false
